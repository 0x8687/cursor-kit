# Debug Report: onKeyPress API Usage Error

**Date**: 2025-12-05  
**Issue**: Incorrect argument label in call (have '_:modifiers:_:', expected '_:phases:action:')  
**File**: `EditorView.swift` line 94  
**Severity**: Compilation Error  
**Status**: Root Cause Identified

## Executive Summary

The `onKeyPress` modifier API in SwiftUI doesn't accept `modifiers` parameter in the way it's being used. The API signature has changed or the usage is incorrect for the macOS version being targeted.

**Root Cause**: Incorrect `onKeyPress` API usage - the modifier parameter syntax is wrong.

**Impact**: Code won't compile.

**Solution**: Use the correct `onKeyPress` API with proper key press handling, or use keyboard shortcuts instead.

## Technical Analysis

### Problem Location

**File**: `ScreenshotApp/Views/EditorView.swift`  
**Line**: 94  
**Code**:
```swift
.onKeyPress(.init("c"), modifiers: [.command, .shift]) {
    // Copy to clipboard
    Task {
        await viewModel.exportAndCopy()
    }
    return .handled
}
```

### Error Messages

1. `Incorrect argument label in call (have '_:modifiers:_:', expected '_:phases:action:')`
2. `Type 'KeyPress.Phases.ArrayLiteralElement' (aka 'KeyPress.Phases') has no member 'command'`
3. `Type 'KeyPress.Phases.ArrayLiteralElement' (aka 'KeyPress.Phases') has no member 'shift'`
4. `Contextual type for closure argument list expects 1 argument, which cannot be implicitly ignored`

### Root Cause

The `onKeyPress` modifier API doesn't support `modifiers` parameter in this form. The API expects:
- `onKeyPress(_ key: KeyPress, phases: KeyPress.Phases = .down, action: @escaping (KeyPress) -> KeyPress.Result)`

The modifiers should be part of the `KeyPress` initializer, not a separate parameter.

### SwiftUI onKeyPress API

The correct API signature is:
```swift
func onKeyPress(
    _ key: KeyPress,
    phases: KeyPress.Phases = .down,
    action: @escaping (KeyPress) -> KeyPress.Result
) -> some View
```

To create a `KeyPress` with modifiers:
```swift
KeyPress(key: .init("c"), modifiers: [.command, .shift])
```

Or use the convenience initializer if available.

## Solution

### Option 1: Use Correct KeyPress Initializer

```swift
.onKeyPress(KeyPress(key: .init("c"), modifiers: [.command, .shift])) { _ in
    Task {
        await viewModel.exportAndCopy()
    }
    return .handled
}
```

### Option 2: Use Keyboard Shortcuts (Recommended)

Since we already have keyboard shortcuts in the toolbar, we can remove the redundant `onKeyPress` modifier. The toolbar shortcuts already handle Cmd+Shift+C.

### Option 3: Use Different API

If the KeyPress API doesn't support modifiers directly, use `.keyboardShortcut` modifier instead, or handle it differently.

## Implementation

**Recommended Fix**: Remove the redundant `onKeyPress` for Cmd+Shift+C since it's already handled by the toolbar shortcut. Keep the delete key handler if it works correctly.

**Alternative Fix**: If we need the `onKeyPress` handler, use:
```swift
.onKeyPress(KeyPress(key: .init("c"), modifiers: [.command, .shift])) { _ in
    Task {
        await viewModel.exportAndCopy()
    }
    return .handled
}
```

## Testing

After fix:
- [ ] Code compiles without errors
- [ ] Keyboard shortcuts work correctly
- [ ] Cmd+Shift+C copies to clipboard
- [ ] Delete key deletes annotations

## Additional Notes

- `onKeyPress` API may vary by macOS version
- Toolbar keyboard shortcuts are more reliable for modifier combinations
- Consider using `.keyboardShortcut` modifier for better compatibility
- The delete key handler (line 88) might also need checking if it has similar issues

---

**Report Generated By**: Debugger Agent  
**Date**: 2025-12-05

